global
	log 127.0.0.1 local0 debug
	daemon

defaults
	timeout connect 5000ms
	timeout client 50000ms
	timeout server 50000ms
	mode http
	# never fail on address resolution since 2 of the 3 should not be reachable
	default-server init-addr last,libc,none
	log global
	option httplog

frontend http-in
	bind *:80
	default_backend prometheus
	capture request header Authorization len 50
	capture request header User-Agent len 64

	# Authorization header, called 'bearer token' inside prometheus config
	# must be the same as in the global_prometheus config
	acl auth_header req.fhdr(Authorization) "Bearer $PROMETHEUS_AUTH_TOKEN"
	http-request deny if ! auth_header

	# %5B%5D is [] escaped
	# acl testp urlp(match%5B%5D) test
	# http-request deny if testp


backend prometheus
	server prometheus prometheus:9090
